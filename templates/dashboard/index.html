{% extends "base.html" %}
{% load static %}
{% block content %}
<div class="page-wrapper">
  <div class="content">

    <!-- Page Header -->
    <div class="page-header">
      <div class="row">
        <div class="col-sm-12">
          <h3 class="page-title">Dashboard</h3>
          <ul class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'accounts:dashboard' %}">Home</a></li>
            <li class="breadcrumb-item active">Overview</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Stat Cards -->
    <div class="row g-4">

      {# ----- ROOMS (always) ----- #}
      <div class="col-xl-3 col-md-6">
        <div class="card text-white bg-primary shadow-lg h-100">
          <div class="card-body d-flex align-items-center">
            <i class="fas fa-bed fa-3x me-3 opacity-75"></i>
            <div>
              <h3 class="fw-bold mb-0">{{ total_rooms }}</h3>
              <small>Total Rooms</small>
            </div>
          </div>
        </div>
      </div>

      {# ----- Customers ----- #}
      {% if total_customers is not None %}
      <div class="col-xl-3 col-md-6">
        <div class="card text-white bg-success shadow-lg h-100">
          <div class="card-body d-flex align-items-center">
            <i class="fas fa-users fa-3x me-3 opacity-75"></i>
            <div>
              <h3 class="fw-bold mb-0">{{ total_customers }}</h3>
              <small>Customers</small>
            </div>
          </div>
        </div>
      </div>
      {% endif %}
      {# ----- Laundry ----- #}
      <div class="col-xl-3 col-md-6">
        <div class="card text-white bg-warning shadow-lg h-100">
          <div class="card-body d-flex align-items-center">
            <i class="fas fa-tshirt fa-3x me-3 opacity-75"></i>
            <div>
              <h3 class="fw-bold mb-0">{{ laundry_total_clothes }}</h3>
              <small>Total Laundry Clothes</small>
            </div>
          </div>
        </div>
      </div>

      <div class="col-xl-3 col-md-6">
        <div class="card text-white bg-danger shadow-lg h-100">
            <div class="card-body d-flex align-items-center">
                <i class="fas fa-clipboard-list fa-3x me-3 opacity-75"></i>
                <div>
                    <h3 class="fw-bold mb-0">{{ total_complaints }}</h3>
                    <small>Total Complaints</small>
                </div>
            </div>
        </div>
      </div>
      <!-- Unresolved Complaints -->
      <div class="col-xl-3 col-md-6">
        <div class="card text-white bg-secondary shadow-lg h-100">
          <div class="card-body d-flex align-items-center">
            <i class="fas fa-exclamation-circle fa-3x me-3 opacity-75"></i>
            <div>
              <h3 class="fw-bold mb-0">{{ unresolved_complaints }}</h3>
              <small>Unresolved Complaints</small>
            </div>
          </div>
        </div>
      </div>

      <!-- Total Sales in the Last 7 Days -->
      <div class="col-xl-3 col-md-6">
        <div class="card text-white bg-success shadow-lg h-100">
          <div class="card-body d-flex align-items-center">
            <i class="fas fa-dollar-sign fa-3x me-3 opacity-75"></i>
            <div>
              <h3 class="fw-bold mb-0">₦{{ total_sales_last_7_days }}</h3>
              <small>Total Sales in Last 7 Days</small>
            </div>
          </div>
        </div>
      </div>

      {# ----- Food items ----- #}
      {% if total_food_items is not None %}
      <div class="col-xl-3 col-md-6">
        <div class="card text-white bg-warning shadow-lg h-100">
          <div class="card-body d-flex align-items-center">
            <i class="fas fa-utensils fa-3x me-3 opacity-75"></i>
            <div>
              <h3 class="fw-bold mb-0">{{ total_food_items }}</h3>
              <small>Food Items</small>
            </div>
          </div>
        </div>
      </div>
      {% endif %}

      {# ----- Reservations ----- #}
      {% if total_reservations is not None %}
      <div class="col-xl-3 col-md-6">
        <div class="card text-white bg-danger shadow-lg h-100">
          <div class="card-body d-flex align-items-center">
            <i class="fas fa-calendar-check fa-3x me-3 opacity-75"></i>
            <div>
              <h3 class="fw-bold mb-0">{{ total_reservations }}</h3>
              <small>Reservations</small>
            </div>
          </div>
        </div>
      </div>
      {% endif %}

      {# ----- Pending staff ----- #}
      {% if pending_staff is not None %}
      <div class="col-xl-3 col-md-6">
        <a href="{% url 'accounts:staff-pending' %}" class="text-decoration-none">
          <div class="card text-white bg-secondary shadow-lg h-100">
            <div class="card-body d-flex align-items-center">
              <i class="fas fa-user-clock fa-3x me-3 opacity-75"></i>
              <div>
                <h3 class="fw-bold mb-0">{{ pending_staff }}</h3>
                <small>Pending Staff</small>
              </div>
            </div>
          </div>
        </a>
      </div>
      {% endif %}

    </div><!-- /row -->

    <!-- Quick lists -->
    <div class="row mt-4">
      <!-- Rooms quick list -->
      <div class="col-lg-6">
        <div class="card shadow-sm">
          <div class="card-header bg-light">
            <h4 class="mb-0">Rooms (Top 10)</h4>
          </div>
          <div class="card-body p-0">
            <table class="table table-sm align-middle mb-0">
              <thead class="table-light">
                <tr><th>#</th><th>Category</th><th>Status</th></tr>
              </thead>
              <tbody>
                {% for room in rooms %}
                  <tr>
                    <td>{{ room.room_number }}</td>
                    <td>{{ room.category.name }}</td>
                    <td>
                      {% if room.is_available %}
                        <span class="badge bg-success">Available</span>
                      {% else %}
                        <span class="badge bg-secondary">Occupied</span>
                      {% endif %}
                    </td>
                  </tr>
                {% empty %}
                  <tr><td colspan="3" class="text-center py-3">No rooms.</td></tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>

      {# Latest reservations (only if user can view them) #}
      {% if latest_reservations %}
      <div class="col-lg-6">
        <div class="card shadow-sm">
          <div class="card-header bg-light">
            <h4 class="mb-0">Latest Reservations</h4>
          </div>
          <div class="card-body p-0">
            <table class="table table-sm align-middle mb-0">
              <thead class="table-light">
                <tr><th>Guest</th><th>Room</th><th>Check‑In</th><th>Status</th></tr>
              </thead>
              <tbody>
                {% for r in latest_reservations %}
                  <tr>
                    <td>{{ r.customer.full_name }}</td>
                    <td>{{ r.room.room_number }}</td>
                    <td>{{ r.check_in|date:"M j" }}</td>
                    <td>
                      <span class="badge
                        {% if r.status == 'pending' %}bg-warning
                        {% elif r.status == 'active' %}bg-info
                        {% elif r.status == 'completed' %}bg-success
                        {% else %}bg-secondary
                        {% endif %}">
                        {{ r.get_status_display }}
                      </span>
                    </td>
                  </tr>
                {% empty %}
                  <tr><td colspan="4" class="text-center py-3">No reservations.</td></tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
      {% endif %}
    </div><!-- /row -->

  </div><!-- /content -->
</div><!-- /wrapper -->
{% endblock %}
